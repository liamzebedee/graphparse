!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-transition"),require("d3-zoom"),require("d3-interpolate"),require("viz.js")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-transition","d3-zoom","d3-interpolate","viz.js"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.Viz)}(this,function(t,e,n,i,r,a){"use strict";function o(){var t=this._selection,n=e.select(t.node().querySelector("svg"));if(0==n.size())return this;this._zoomSelection=n;var r=[.1,10],a=i.zoom().scaleExtent(r).on("zoom",function(){o.attr("transform",e.event.transform)});this._zoomBehavior=a;var o=e.select(n.node().querySelector("g"));return n.call(a),this._active||h.call(this,o),this}function s(t){var e=t.node().transform;if(e&&0!=e.baseVal.length){var n=e.baseVal.consolidate().matrix;return{x:n.e,y:n.f}}return{x:0,y:0}}function l(t){var e=this._translation,n=t.datum().translation,r=n.x-e.x,a=n.y-e.y;return i.zoomTransform(this._zoomSelection.node()).translate(r,a)}function h(t){this._zoomBehavior.transform(this._zoomSelection,l.call(this,t)),this._translation=t.datum().translation}function u(t){var e={},n=t.node().nodeName;e.tag=n,e.attributes={};var i=t.node().attributes;if(i)for(var r=0;r<i.length;r++){var a=i[r],o=a.name,l=a.value;e.attributes[o]=l}if(t.node().transform){var h=s(t);0==h.x&&0==h.y||(e.translation=h)}if("ellipse"==n&&e.attributes.cx&&(e.center={x:e.attributes.cx,y:e.attributes.cy}),"polygon"==n&&e.attributes.points){var u=t.attr("points").split(" "),c=u.map(function(t){return t.split(",")[0]}),f=u.map(function(t){return t.split(",")[1]}),d=Math.min.apply(null,c),g=Math.max.apply(null,c),p=Math.min.apply(null,f),v=Math.max.apply(null,f),y={x:d,y:p,width:g-d,height:v-p};e.bbox=y,e.center={x:p+v/2,y:p+v/2}}return"path"==n&&(t.node().getTotalLength?e.totalLength=t.node().getTotalLength():e.totalLength=100),"#text"==n?e.text=t.text():"#comment"==n&&(e.comment=t.text()),e}function c(t){return"#text"==t.tag?document.createTextNode(""):"#comment"==t.tag?document.createComment(t.comment):document.createElementNS("http://www.w3.org/2000/svg",t.tag)}function f(t){var n=c(t),i=e.select(n),r=t.attributes;if(r)for(var a of Object.keys(r)){var o=r[a];i.attr(a,o)}return n}function d(t,n){var i=e.select(t.node().parentNode),r=f(n),a=i.insert(function(){return r},function(){return t.node()});return t.remove(),a}function g(t){return Object.assign({},t)}function p(t,e){return function(){var n=t.map(function(t){return r.interpolate([t[0][0],t[0][1]],[t[1][0],t[1][1]])});return function(t){return t<1?"M"+n.map(function(e){return e(t)}).join("L"):e}}}function v(t,e,n){var i=t,r=i.cloneNode();if(t.getTotalLength)var a=i.getTotalLength(),o=(r.setAttribute("d",e),r).getTotalLength();else var a=100,o=50;for(var s=[0],l=0,h=n/Math.max(a,o);(l+=h)<1;)s.push(l);return s.push(1),s.map(function(e){if(t.getPointAtLength)var n=i.getPointAtLength(e*a),s=r.getPointAtLength(e*o);else var n={x:e*a,y:e*a},s={x:e*o,y:e*o};return[[n.x,n.y],[s.x,s.y]]})}function y(t){return"edge"==t.attributes.class||"a"==t.tag&&"g"==t.parent.tag&&"edge"==t.parent.parent.attributes.class}function m(t){return t.parent&&y(t.parent)}function x(t){return"edge"==t.parent.attributes.class?t.parent:t.parent.parent.parent}function _(t){return x(t).children.find(function(t){return"title"==t.tag})}function b(t,e){if("polygon"==t.tag){(E=g(t)).tag="path";u=g(h=t.attributes);if(null!=h.points){var n=h.points;if("polygon"==e.tag){(v=t.bbox).cx=v.x+v.width/2,v.cy=v.y+v.height/2;for(var i=h.points.split(" "),r=i.map(function(t){var e=t.split(",");return[e[0]-v.cx,e[1]-v.cy]}),a=r[r.length-1][0],o=r[r.length-1][1],s=0;s<r.length;s++,a=z,o=k){_=(z=r[s][0])-a;if(0!=(b=(k=r[s][1])-o)&&(0<=(L=a-o*_/b)&&L<1/0&&(a<=L&&L<=z||z<=L&&L<=a)))break}var l=[[v.cx+L,v.cy+0].join(",")];n=(l=(l=l.concat(i.slice(s))).concat(i.slice(0,s))).join(" ")}u.d="M"+n+"z",delete u.points}E.attributes=u}else if("ellipse"==t.tag){(E=g(t)).tag="path";var h=t.attributes,u=g(h);if(null!=h.cx){var c=h.cx,f=h.cy,d=h.rx,p=h.ry,v=e.bbox;v.cx=v.x+v.width/2,v.cy=v.y+v.height/2;var y=e.attributes.points.split(" ")[0].split(","),m=y[0],x=y[1],_=m-v.cx,b=x-v.cy,w=Math.sqrt(Math.pow(_,2)+Math.pow(b,2)),M=_/w,P=-b/w,z=d*M,k=-p*P,L=d*-M,_=L-z,b=-p*-P-k;u.d="M "+c+" "+f+" m "+z+","+k+" a "+d+","+p+" 0 1,0 "+_+","+b+" a "+d+","+p+" 0 1,0 "+-_+","+-b+"z",delete u.cx,delete u.cy,delete u.rx,delete u.ry}E.attributes=u}else var E=t;return E}function w(t){this._selection=t,this._active=!1,this._jobs=[],this._keyModes=new Set(["title","id","tag-index","index"]),this._engine="dot",this._totalMemory=void 0,this._keyMode="title",this._fade=!0,this._tweenPaths=!0,this._tweenShapes=!0,this._convertEqualSidedPolygons=!0,this._tweenPrecision=1,this._growEnteringEdges=!0,this._translation={x:0,y:0},this._zoom=!0}function M(t){return new w(e.select(t))}w.prototype=M.prototype={constructor:w,engine:function(t){if(t!=this._engine&&null!=this._data)throw Error("Too late to change engine");return this._engine=t,this},totalMemory:function(t){return this._totalMemory=t,this},keyMode:function(t){if(!this._keyModes.has(t))throw Error("Illegal keyMode: "+t);if(t!=this._keyMode&&null!=this._data)throw Error("Too late to change keyMode");return this._keyMode=t,this},fade:function(t){return this._fade=t,this},tweenPaths:function(t){return this._tweenPaths=t,this},tweenShapes:function(t){return this._tweenShapes=t,t&&(this._tweenPaths=!0),this},convertEqualSidedPolygons:function(t){return this._convertEqualSidedPolygons=t,this},tweenPrecision:function(t){return this._tweenPrecision=t,this},growEnteringEdges:function(t){return this._growEnteringEdges=t,this},zoom:function(t){return this._zoom=t,this._zoom&&!this._zoomBehavior&&o.call(this),this},render:function(){function t(o){var x=o.selectAll(function(){return o.node().childNodes}),_=(x=x.data(function(t){return t.children},function(t){return t.key})).enter().append(function(t){var e=c(t);return"#text"==t.tag&&i&&(e.nodeValue=t.text),e});(i||f&&y(o.datum()))&&_.filter(function(t){return"#"==t.tag[0]?null:this}).each(function(t){var n=e.select(this);for(var i of Object.keys(t.attributes)){var r=t.attributes[i];n.attr(i,r)}}).filter(function(t){return"svg"==t.tag||"g"==t.tag?null:this}).style("opacity",0);var b=x.exit();g&&b.each(g),n&&(b=b.transition(n),i&&b.filter(function(t){return"#"==t.tag[0]?null:this}).style("opacity",0)),b=b.remove(),x=_.merge(x),g&&x.each(g),x.each(function(c){var g=e.select(this),y=c.tag,x=c.attributes,_=!1;if(a&&n&&c.alternativeOld){if("polygon"==this.nodeName||"ellipse"==this.nodeName){_=!0;var b=u(g);if("polygon"==this.nodeName&&"polygon"==y){var w=b.attributes.points;if(null==w)_=!1;else if(!s){var M=w.split(" ").length;(I=c.attributes.points).split(" ").length==M&&(_=!1)}}else"ellipse"==this.nodeName&&"ellipse"==y&&(_=!1)}if(_){var P=c.alternativeOld,z=d(g,P);z.data([c],function(){return c.key});var k=c.alternativeNew;g=z,y="path",x=k.attributes}}var L=g;if(n&&(L=L.transition(n),i&&L.filter(function(t){return"#"==t.tag[0]?null:this}).style("opacity",1),L.filter(function(t){return"#"==t.tag[0]?null:this}).on("end",function(){e.select(this).attr("style",null)})),f&&"path"==y&&c.offset){var E=c.totalLength;g.attr("stroke-dasharray",E+" "+E).attr("stroke-dashoffset",E).attr("transform","translate("+c.offset.x+","+c.offset.y+")"),L.attr("stroke-dashoffset",0).attr("transform","translate(0,0)").on("start",function(){e.select(this).style("opacity",null)}).on("end",function(){e.select(this).attr("stroke-dashoffset",null).attr("stroke-dasharray",null).attr("transform",null)})}if(f&&"polygon"==y&&m(c)&&c.offset){var S=e.select(o.node().querySelector("path"));if(S.node().getPointAtLength)var N=S.node().getPointAtLength(0),j=S.node().getPointAtLength(c.totalLength),O=S.node().getPointAtLength(c.totalLength-1),q=180*Math.atan2(j.y-O.y,j.x-O.x)/Math.PI;else var N={x:0,y:0},j={x:100,y:100},q=0;var A=N.x-j.x+c.offset.x,T=N.y-j.y+c.offset.y;g.attr("transform","translate("+A+","+T+")"),L.attrTween("transform",function(){return function(t){if(S.node().getPointAtLength)var e=S.node().getPointAtLength(c.totalLength*t),n=S.node().getPointAtLength(c.totalLength*t+1),i=180*Math.atan2(n.y-e.y,n.x-e.x)/Math.PI-q;else var e={x:100*t,y:100*t},i=0;return A=e.x-j.x+c.offset.x*(1-t),T=e.y-j.y+c.offset.y*(1-t),"translate("+A+","+T+") rotate("+i+" "+j.x+" "+j.y+")"}}).on("start",function(){e.select(this).style("opacity",null)}).on("end",function(){e.select(this).attr("transform",null)})}var B=r&&n&&"path"==y&&null!=g.attr("d");for(var V of Object.keys(x)){var D=x[V];if(B&&"d"==V){var I=(c.alternativeOld||c).points;I&&L.attrTween("d",p(I,D))}else"transform"==V&&c.translation&&L.on("start",function(){v._zoomBehavior&&L.attr(V,l.call(v,g).toString())}).on("end",function(){v._zoomBehavior&&h.call(v,g)}),L.attr(V,D)}_&&L.on("end",function(t,n,i){this.nodeName!=t.tag&&d(z=e.select(this),t).data([t],function(){return t.key})}),c.text&&L.text(c.text),t(g)})}var n=this._transition,i=this._fade&&null!=n,r=this._tweenPaths,a=this._tweenShapes,s=this._convertEqualSidedPolygons,f=(this._tweenPrecision,this._growEnteringEdges&&null!=n),g=this._attributer,v=this,x=this._selection;if(null!=n){var _=this._jobs;if(v._active)return _.push(null),this;x.transition(n).transition().duration(0).on("end",function(){v._active=!1,0!=_.length&&(_.shift(),v.render())}),this._active=!0}var b=this._data;return x.datum({attributes:{},children:[b]}),t(x),this._zoom&&!this._zoomBehavior&&o.call(this),this},dot:function(t){function n(t,i=0,r){var a=u(t);a.parent=r,a.children=[];var o=a.tag;"#text"==o?a.text=t.text():"#comment"==o&&(a.comment=t.text());var d=e.selectAll(t.node().childNodes);"index"==s?a.key=i:"#"!=o[0]&&("id"==s?a.key=t.attr("id"):"title"==s&&(t.select("title"),t.select("title").empty()||(a.key=t.select("title").text()))),null==a.key&&(h&&("ellipse"!=o&&"polygon"!=o||(o="path")),a.key=o+"-"+i);var y=(r?r.id+".":"")+a.key;a.id=y,g[y]=a;var m=p[y];if(h&&y in p&&("polygon"!=m.tag&&"ellipse"!=m.tag||m.tag==a.tag&&"polygon"!=a.tag||(a.alternativeOld=b(m,a),a.alternativeNew=b(a,m))),l&&m&&("path"==m.tag||a.alternativeOld&&"path"==a.alternativeOld.tag)){var x=(a.alternativeNew||a).attributes.d;if(a.alternativeOld)_=f(a.alternativeOld);else var _=f(m);(a.alternativeOld||(a.alternativeOld={})).points=v(_,x,c)}var w={};return d.each(function(){if(null!==this){var t=this.nodeName;"ellipse"!=t&&"polygon"!=t||(t="path"),null==w[t]&&(w[t]=0);var i=w[t]++,r=n(e.select(this),i,a);r&&a.children.push(r)}}),a}function i(t){var e=t.id,n=t.tag,r=p[e];if(d&&t.parent&&"node"==t.parent.attributes.class&&"title"==n){var a=(s=t.children[0]).text;y[a]=t.parent}if(d&&!r&&t.parent&&m(t)&&("path"==n||"polygon"==n)){if("polygon"==n){var o=t.parent.children.find(function(t){return"path"==t.tag});t.totalLength=o.totalLength}var s=_(t).children[0],l=s.text.split("->");2!=l.length&&(l=s.text.split("--"));var h=l[0],u=y[h],c=x[h];if(c){var f=u.children[3],g=c.children[3];if("polygon"!=f.tag&&"ellipse"!=f.tag)throw Error("Unexpected tag: "+f.tag,". Please file an issue at https://github.com/magjac/d3-graphviz/issues");if("polygon"!=g.tag&&"ellipse"!=g.tag)throw Error("Unexpected tag: "+g.tag,". Please file an issue at https://github.com/magjac/d3-graphviz/issues");t.offset={x:g.center.x-f.center.x,y:g.center.y-f.center.y}}}return t.children.forEach(function(t){i(t)}),t}var r=this._engine,o=this._totalMemory,s=this._keyMode,l=this._tweenPaths,h=this._tweenShapes,c=this._tweenPrecision,d=this._growEnteringEdges,g={},p=this._dictionary||{},y={},x=this._nodeDictionary||{},w=a(t,{format:"svg",engine:r,totalMemory:o}),M=e.selection().append("div").attr("display","none");M.html(w);var P=i(P=n(M.select("svg")));return this._data=P,this._dictionary=g,this._nodeDictionary=y,M.remove(),this},renderDot:function(t){return this.dot(t).render(),this},transition:function(t){return this._transition=n.transition(t),this},attributer:function(t){return this._attributer=t,this}},e.selection.prototype.graphviz=function(){return new w(this)},t.graphviz=M,Object.defineProperty(t,"__esModule",{value:!0})});